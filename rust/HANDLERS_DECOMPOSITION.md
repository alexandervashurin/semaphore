# üìã –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è handlers.rs

**–§–∞–π–ª**: `rust/src/api/handlers.rs` (1011 —Å—Ç—Ä–æ–∫)
**–°—Ç–∞—Ç—É—Å**: üöß –í –ü–†–û–¶–ï–°–°–ï

---

## üìä –¢–µ–∫—É—â–∞—è –°—Ç—Ä—É–∫—Ç—É—Ä–∞

–§–∞–π–ª —É–∂–µ —Ä–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Å–µ–∫—Ü–∏–∏:

| –°–µ–∫—Ü–∏—è | –°—Ç—Ä–æ–∫–∏ | –ú–µ—Ç–æ–¥–æ–≤ |
|--------|--------|---------|
| **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** | 1-124 | 3 |
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** | 125-201 | 6 |
| **–ü—Ä–æ–µ–∫—Ç—ã** | 202-293 | 8 |
| **–®–∞–±–ª–æ–Ω—ã** | 294-404 | 10 |
| **–ó–∞–¥–∞—á–∏** | 405-491 | 8 |
| **–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏** | 492-586 | 8 |
| **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏** | 587-680 | 8 |
| **–û–∫—Ä—É–∂–µ–Ω–∏—è** | 681-774 | 8 |
| **–ö–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞** | 775-852 | 7 |
| **TOTP (2FA)** | 853-1011 | 5 |

**–ò—Ç–æ–≥–æ**: 10 —Å–µ–∫—Ü–∏–π, ~71 –º–µ—Ç–æ–¥

---

## üéØ –ü–ª–∞–Ω –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏

### 1. `handlers/auth.rs` (~125 —Å—Ç—Ä–æ–∫)

**–ú–µ—Ç–æ–¥—ã**:
- `health()` - health check
- `login()` - –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- `logout()` - –≤—ã—Ö–æ–¥
- `register()` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `crate::api::auth::*`
- `crate::api::auth_local::*`
- `crate::services::totp::*`

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ –≥–æ—Ç–æ–≤–æ (–Ω—É–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å)

---

### 2. `handlers/users.rs` (~77 —Å—Ç—Ä–æ–∫)

**–ú–µ—Ç–æ–¥—ã**:
- `get_current_user()` - –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `update_current_user()` - –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
- `change_password()` - —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
- `get_api_tokens()` - –ø–æ–ª—É—á–∏—Ç—å API —Ç–æ–∫–µ–Ω—ã
- `create_api_token()` - —Å–æ–∑–¥–∞—Ç—å —Ç–æ–∫–µ–Ω
- `delete_api_token()` - —É–¥–∞–ª–∏—Ç—å —Ç–æ–∫–µ–Ω

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `crate::models::User`
- `crate::api::auth::*`

**–°—Ç–∞—Ç—É—Å**: ‚è≥ –í –ø–ª–∞–Ω–µ

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –£–∂–µ –µ—Å—Ç—å `api/user.rs`, –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å

---

### 3. `handlers/projects.rs` (~92 —Å—Ç—Ä–æ–∫–∏)

**–ú–µ—Ç–æ–¥—ã**:
- `get_projects()` - —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
- `get_project()` - –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
- `create_project()` - —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
- `update_project()` - –æ–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
- `delete_project()` - —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
- `get_project_users()` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
- `add_project_user()` - –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `delete_project_user()` - —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `crate::models::Project`
- `crate::db::store::ProjectManager`

**–°—Ç–∞—Ç—É—Å**: ‚è≥ –í –ø–ª–∞–Ω–µ

---

### 4. `handlers/templates.rs` (~111 —Å—Ç—Ä–æ–∫)

**–ú–µ—Ç–æ–¥—ã**:
- `get_templates()` - —Å–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤
- `get_template()` - –ø–æ–ª—É—á–∏—Ç—å —à–∞–±–ª–æ–Ω
- `create_template()` - —Å–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω
- `update_template()` - –æ–±–Ω–æ–≤–∏—Ç—å —à–∞–±–ª–æ–Ω
- `delete_template()` - —É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω
- `get_template_refs()` - —Å—Å—ã–ª–∫–∏ –Ω–∞ —à–∞–±–ª–æ–Ω
- `run_template()` - –∑–∞–ø—É—Å—Ç–∏—Ç—å —à–∞–±–ª–æ–Ω
- `get_template_schedules()` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
- `get_template_events()` - —Å–æ–±—ã—Ç–∏—è
- `get_template_vaults()` - vaults

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `crate::models::Template`
- `crate::db::store::TemplateManager`

**–°—Ç–∞—Ç—É—Å**: ‚è≥ –í –ø–ª–∞–Ω–µ

---

### 5. `handlers/tasks.rs` (~87 —Å—Ç—Ä–æ–∫)

**–ú–µ—Ç–æ–¥—ã**:
- `get_tasks()` - —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
- `get_task()` - –ø–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á—É
- `stop_task()` - –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á—É
- `start_task()` - –∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–∞—á—É
- `get_task_output()` - –≤—ã–≤–æ–¥ –∑–∞–¥–∞—á–∏
- `get_task_stages()` - —ç—Ç–∞–ø—ã –∑–∞–¥–∞—á–∏
- `confirm_task()` - –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–¥–∞—á—É
- `reject_task()` - –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞–¥–∞—á—É

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `crate::models::Task`
- `crate::services::task_pool::TaskPool`

**–°—Ç–∞—Ç—É—Å**: ‚è≥ –í –ø–ª–∞–Ω–µ

---

### 6. `handlers/inventory.rs` (~95 —Å—Ç—Ä–æ–∫)

**–ú–µ—Ç–æ–¥—ã**:
- `get_inventories()` - —Å–ø–∏—Å–æ–∫ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ–π
- `get_inventory()` - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
- `create_inventory()` - —Å–æ–∑–¥–∞—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
- `update_inventory()` - –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
- `delete_inventory()` - —É–¥–∞–ª–∏—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
- `get_inventory_refs()` - —Å—Å—ã–ª–∫–∏
- `get_terraform_aliases()` - Terraform aliases (PRO)
- `get_terraform_states()` - Terraform states (PRO)

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `crate::models::Inventory`
- `crate::models::TerraformInventoryAlias` (PRO)

**–°—Ç–∞—Ç—É—Å**: ‚è≥ –í –ø–ª–∞–Ω–µ

---

### 7. `handlers/repository.rs` (~94 —Å—Ç—Ä–æ–∫–∏)

**–ú–µ—Ç–æ–¥—ã**:
- `get_repositories()` - —Å–ø–∏—Å–æ–∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
- `get_repository()` - –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- `create_repository()` - —Å–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- `update_repository()` - –æ–±–Ω–æ–≤–∏—Ç—å
- `delete_repository()` - —É–¥–∞–ª–∏—Ç—å
- `get_repository_refs()` - —Å—Å—ã–ª–∫–∏
- `sync_repository()` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
- `get_repository_events()` - —Å–æ–±—ã—Ç–∏—è

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `crate::models::Repository`
- `crate::services::git_repository::GitRepository`

**–°—Ç–∞—Ç—É—Å**: ‚è≥ –í –ø–ª–∞–Ω–µ

---

### 8. `handlers/environment.rs` (~94 —Å—Ç—Ä–æ–∫–∏)

**–ú–µ—Ç–æ–¥—ã**:
- `get_environments()` - —Å–ø–∏—Å–æ–∫ –æ–∫—Ä—É–∂–µ–Ω–∏–π
- `get_environment()` - –ø–æ–ª—É—á–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- `create_environment()` - —Å–æ–∑–¥–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- `update_environment()` - –æ–±–Ω–æ–≤–∏—Ç—å
- `delete_environment()` - —É–¥–∞–ª–∏—Ç—å
- `get_environment_refs()` - —Å—Å—ã–ª–∫–∏
- `get_environment_secrets()` - —Å–µ–∫—Ä–µ—Ç—ã
- `update_environment_secrets()` - –æ–±–Ω–æ–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `crate::models::Environment`
- `crate::models::EnvironmentSecret`

**–°—Ç–∞—Ç—É—Å**: ‚è≥ –í –ø–ª–∞–Ω–µ

---

### 9. `handlers/access_key.rs` (~78 —Å—Ç—Ä–æ–∫)

**–ú–µ—Ç–æ–¥—ã**:
- `get_access_keys()` - —Å–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–π
- `get_access_key()` - –ø–æ–ª—É—á–∏—Ç—å –∫–ª—é—á
- `create_access_key()` - —Å–æ–∑–¥–∞—Ç—å –∫–ª—é—á
- `update_access_key()` - –æ–±–Ω–æ–≤–∏—Ç—å
- `delete_access_key()` - —É–¥–∞–ª–∏—Ç—å
- `get_access_key_refs()` - —Å—Å—ã–ª–∫–∏
- `get_access_key_installation()` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `crate::models::AccessKey`
- `crate::services::access_key_installer::AccessKeyInstaller`

**–°—Ç–∞—Ç—É—Å**: ‚è≥ –í –ø–ª–∞–Ω–µ

---

### 10. `handlers/totp.rs` (~159 —Å—Ç—Ä–æ–∫)

**–ú–µ—Ç–æ–¥—ã**:
- `create_totp()` - —Å–æ–∑–¥–∞—Ç—å TOTP
- `verify_totp()` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å TOTP
- `disable_totp()` - –æ—Ç–∫–ª—é—á–∏—Ç—å TOTP
- `get_totp_status()` - —Å—Ç–∞—Ç—É—Å TOTP
- `verify_recovery_code()` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å recovery code

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `crate::services::totp::*`
- `crate::models::UserTotp`

**–°—Ç–∞—Ç—É—Å**: ‚è≥ –í –ø–ª–∞–Ω–µ

---

## üìÅ –ù–æ–≤–∞—è –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
rust/src/api/
‚îú‚îÄ‚îÄ handlers.rs              # –†–µ-—ç–∫—Å–ø–æ—Ä—Ç (–æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ –º–æ–¥—É–ª–∏)
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ mod.rs               # –ú–æ–¥—É–ª—å handlers
‚îÇ   ‚îú‚îÄ‚îÄ auth.rs              # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ users.rs             # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ projects.rs          # –ü—Ä–æ–µ–∫—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ templates.rs         # –®–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ tasks.rs             # –ó–∞–¥–∞—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ inventory.rs         # –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏
‚îÇ   ‚îú‚îÄ‚îÄ repository.rs        # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ environment.rs       # –û–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ access_key.rs        # –ö–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞
‚îÇ   ‚îî‚îÄ‚îÄ totp.rs              # TOTP
```

---

## üéØ –≠—Ç–∞–ø—ã –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1 —á–∞—Å)

- [ ] –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `rust/src/api/handlers/`
- [ ] –°–æ–∑–¥–∞—Ç—å `mod.rs`
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —à–∞–±–ª–æ–Ω—ã —Ñ–∞–π–ª–æ–≤

### –≠—Ç–∞–ø 2: –ü–µ—Ä–µ–Ω–æ—Å (4 —á–∞—Å–∞)

- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `auth.rs` (~125 —Å—Ç—Ä–æ–∫)
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `users.rs` (~77 —Å—Ç—Ä–æ–∫)
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `projects.rs` (~92 —Å—Ç—Ä–æ–∫–∏)
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `templates.rs` (~111 —Å—Ç—Ä–æ–∫)
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `tasks.rs` (~87 —Å—Ç—Ä–æ–∫)

### –≠—Ç–∞–ø 3: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ (3 —á–∞—Å–∞)

- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `inventory.rs` (~95 —Å—Ç—Ä–æ–∫)
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `repository.rs` (~94 —Å—Ç—Ä–æ–∫–∏)
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `environment.rs` (~94 —Å—Ç—Ä–æ–∫–∏)
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `access_key.rs` (~78 —Å—Ç—Ä–æ–∫)
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `totp.rs` (~159 —Å—Ç—Ä–æ–∫)

### –≠—Ç–∞–ø 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (2 —á–∞—Å–∞)

- [ ] –û–±–Ω–æ–≤–∏—Ç—å `handlers.rs` (—Ä–µ-—ç–∫—Å–ø–æ—Ä—Ç)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `routes.rs`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é
- [ ] –¢–µ—Å—Ç—ã

---

## üìà –ü—Ä–æ–≥—Ä–µ—Å—Å

| –≠—Ç–∞–ø | –°—Ç–∞—Ç—É—Å | –ü—Ä–æ–≥—Ä–µ—Å—Å |
|------|--------|----------|
| **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞** | ‚è≥ –í –ø–ª–∞–Ω–µ | 0% |
| **–ü–µ—Ä–µ–Ω–æ—Å (—á–∞—Å—Ç—å 1)** | ‚è≥ –í –ø–ª–∞–Ω–µ | 0% |
| **–ü–µ—Ä–µ–Ω–æ—Å (—á–∞—Å—Ç—å 2)** | ‚è≥ –í –ø–ª–∞–Ω–µ | 0% |
| **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** | ‚è≥ –í –ø–ª–∞–Ω–µ | 0% |
| **–í–°–ï–ì–û** | ‚è≥ –í –ø–ª–∞–Ω–µ | 0% |

---

## üîß –ö–æ–º–∞–Ω–¥—ã

### –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
```bash
cd rust/src/api
mkdir handlers
touch handlers/mod.rs
touch handlers/{auth,users,projects,templates,tasks}.rs
touch handlers/{inventory,repository,environment,access_key,totp}.rs
```

### –ü–µ—Ä–µ–Ω–æ—Å –∫–æ–¥–∞
```bash
# –í—ã—Ä–µ–∑–∞—Ç—å —Å–µ–∫—Ü–∏–∏ –∏–∑ handlers.rs
# –í—Å—Ç–∞–≤–∏—Ç—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
cargo check
cargo test handlers
```

---

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π**: Alexander Vashurin
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ù–∞—á–∞–ª–æ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ (–≠—Ç–∞–ø 1)
