# –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è TaskRunner.go –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Rust

**–î–∞—Ç–∞**: 2026-02-26  
**–°—Ç–∞—Ç—É—Å**: üìã –ü–ª–∞–Ω

---

## üìä –ü—Ä–æ–±–ª–µ–º–∞

–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª `TaskRunner.go` —Å–æ–¥–µ—Ä–∂–∏—Ç **440 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞** –∏ –≤–∫–ª—é—á–∞–µ—Ç:
- –°—Ç—Ä—É–∫—Ç—É—Ä—É TaskRunner
- –ó–∞–¥–∞—á—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (run)
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫—É –¥–µ—Ç–∞–ª–µ–π –∑–∞–¥–∞—á–∏
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å—Ç–∞—Ç—É—Å—ã
- WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å hooks

–¢–∞–∫–æ–π —Ñ–∞–π–ª —Å–ª–æ–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Rust —Ü–µ–ª–∏–∫–æ–º.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ **7 –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π**:

| –§–∞–π–ª | –°—Ç—Ä–æ–∫ (Go) | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|------------|----------|
| `task_runner_types.go` | ~60 | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –±–∞–∑–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã |
| `task_runner_lifecycle.go` | ~80 | –°–æ–∑–¥–∞–Ω–∏–µ, –∑–∞–ø—É—Å–∫, –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ |
| `task_runner_details.go` | ~100 | –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–µ—Ç–∞–ª–µ–π –∑–∞–¥–∞—á–∏ |
| `task_runner_logging.go` | ~70 | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å—Ç–∞—Ç—É—Å—ã |
| `task_runner_websocket.go` | ~50 | WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| `task_runner_hooks.go` | ~40 | Hooks (Ansible –∏ –¥—Ä.) |
| `task_runner_error.go` | ~40 | –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ |
| **–ò–¢–û–ì–û** | **~440** | **–í 7 —Ä–∞–∑ –º–µ–Ω—å—à–µ!** |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

### 1. task_runner_types.go

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –±–∞–∑–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã

**–§—É–Ω–∫—Ü–∏–∏**:
- `TaskRunner` struct - –æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- `Job` interface - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–¥–∞—á–∏
- `NewTaskRunner()` - –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- `AddStatusListener()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª—É—à–∞—Ç–µ–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤
- `AddLogListener()` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª—É—à–∞—Ç–µ–ª—è –ª–æ–≥–æ–≤

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: 
- `db.Task`, `db.Template`, `db.Inventory`, `db.Repository`, `db.Environment`
- `task_logger.StatusListener`, `task_logger.LogListener`
- `db_lib.AccessKeyInstaller`

---

### 2. task_runner_lifecycle.go

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–¥–∞—á–∏

**–§—É–Ω–∫—Ü–∏–∏**:
- `run()` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –∑–∞–ø—É—Å–∫–∞
- `kill()` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏
- `createTaskEvent()` - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –∑–∞–¥–∞—á–∏

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `TaskPool`
- `LocalJob`
- `task_logger`

---

### 3. task_runner_details.go

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–µ—Ç–∞–ª–µ–π –∑–∞–¥–∞—á–∏

**–§—É–Ω–∫—Ü–∏–∏**:
- `populateDetails()` - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤—Å–µ—Ö –¥–µ—Ç–∞–ª–µ–π
- `populateTaskEnvironment()` - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–∞, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `db.Store`
- `db.Template`, `db.Inventory`, `db.Repository`, `db.Environment`

---

### 4. task_runner_logging.go

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å—Ç–∞—Ç—É—Å—ã

**–§—É–Ω–∫—Ü–∏–∏**:
- `saveStatus()` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–ª—É—à–∞—Ç–µ–ª–µ–π

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `task_logger`
- `sockets`

---

### 5. task_runner_websocket.go

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–§—É–Ω–∫—Ü–∏–∏**:
- –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `sockets.Message`
- `json.Marshal`

---

### 6. task_runner_hooks.go

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Hooks –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–¥–∞—á

**–§—É–Ω–∫—Ü–∏–∏**:
- Ansible hooks
- Terraform hooks
- Shell hooks

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `hooks` package
- `pro_interfaces`

---

### 7. task_runner_error.go

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–§—É–Ω–∫—Ü–∏–∏**:
- `prepareError()` - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ—à–∏–±–æ–∫
- –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
- `errors`
- `log`

---

## üîÑ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Rust

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã (1 –¥–µ–Ω—å)

**–§–∞–π–ª**: `rust/src/services/task_runner/types.rs`

**–ó–∞–¥–∞—á–∏**:
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É `TaskRunner`
- [ ] –°–æ–∑–¥–∞—Ç—å trait `Job`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `new()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `add_status_listener()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `add_log_listener()`

---

### –≠—Ç–∞–ø 2: Lifecycle (2 –¥–Ω—è)

**–§–∞–π–ª**: `rust/src/services/task_runner/lifecycle.rs`

**–ó–∞–¥–∞—á–∏**:
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `run()` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `kill()` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `create_task_event()` - —Å–æ–±—ã—Ç–∏–µ
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `TaskPool`
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `LocalJob`

---

### –≠—Ç–∞–ø 3: Details (2 –¥–Ω—è)

**–§–∞–π–ª**: `rust/src/services/task_runner/details.rs`

**–ó–∞–¥–∞—á–∏**:
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `populate_details()`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `populate_task_environment()`
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `Store`
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î

---

### –≠—Ç–∞–ø 4: Logging (1-2 –¥–Ω—è)

**–§–∞–π–ª**: `rust/src/services/task_runner/logging.rs`

**–ó–∞–¥–∞—á–∏**:
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `save_status()`
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–ª—É—à–∞—Ç–µ–ª–µ–π
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `TaskLogger`

---

### –≠—Ç–∞–ø 5: WebSocket (1 –¥–µ–Ω—å)

**–§–∞–π–ª**: `rust/src/services/task_runner/websocket.rs`

**–ó–∞–¥–∞—á–∏**:
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `WebSocketManager`

---

### –≠—Ç–∞–ø 6: Hooks (1-2 –¥–Ω—è)

**–§–∞–π–ª**: `rust/src/services/task_runner/hooks.rs`

**–ó–∞–¥–∞—á–∏**:
- [ ] Ansible hooks
- [ ] Terraform hooks
- [ ] Shell hooks
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å PRO hooks

---

### –≠—Ç–∞–ø 7: Errors (1 –¥–µ–Ω—å)

**–§–∞–π–ª**: `rust/src/services/task_runner/errors.rs`

**–ó–∞–¥–∞—á–∏**:
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `prepare_error()`
- [ ] –¢–∏–ø—ã –æ—à–∏–±–æ–∫
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

### –≠—Ç–∞–ø 8: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (3-5 –¥–Ω–µ–π)

**–ó–∞–¥–∞—á–∏**:
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
- [ ] Integration —Ç–µ—Å—Ç—ã
- [ ] –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏
- [ ] E2E —Ç–µ—Å—Ç—ã

---

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏

### –î–æ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏:
- ‚ùå 440 —Å—Ç—Ä–æ–∫ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
- ‚ùå –°–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚ùå –°–ª–æ–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ —á–∞—Å—Ç—è–º

### –ü–æ—Å–ª–µ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏:
- ‚úÖ 7 –º–æ–¥—É–ª–µ–π –ø–æ 40-100 —Å—Ç—Ä–æ–∫
- ‚úÖ –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
- ‚úÖ –ß—ë—Ç–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- ‚úÖ –ú–æ–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ—ç—Ç–∞–ø–Ω–æ
- ‚úÖ –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–°–æ–∑–¥–∞—Ç—å Go –º–æ–¥—É–ª–∏** (1-2 –¥–Ω—è)
   - –†–∞–∑–¥–µ–ª–∏—Ç—å TaskRunner.go –Ω–∞ 7 —Ñ–∞–π–ª–æ–≤
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã

2. **–ù–∞—á–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ Rust** (7-10 –¥–Ω–µ–π)
   - –°–ª–µ–¥–æ–≤–∞—Ç—å –ø–ª–∞–Ω—É –≤—ã—à–µ
   - –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –æ—Ç–¥–µ–ª—å–Ω–æ
   - –ü–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã —Å—Ä–∞–∑—É

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (2-3 –¥–Ω—è)
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å TaskPool
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å LocalJob
   - –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìö –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [LOCAL_JOB_DECOMPOSITION.md](./LOCAL_JOB_DECOMPOSITION.md) - —É—Å–ø–µ—à–Ω–∞—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è LocalJob
- [REMAINING_MODULES_MIGRATION_PLAN.md](./REMAINING_MODULES_MIGRATION_PLAN.md) - –æ–±—â–∏–π –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

---

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π**: Alexander Vashurin  
**–î–∞—Ç–∞**: 2026-02-26  
**–°—Ç–∞—Ç—É—Å**: üìã –ü–õ–ê–ù  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –°–æ–∑–¥–∞—Ç—å 7 Go –º–æ–¥—É–ª–µ–π –¥–ª—è TaskRunner
